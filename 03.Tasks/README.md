# Урок 3 

## Знакомство с платформой Raspberry Pi

### Задания

#### Задача 1. Локальный чат

Работа с TCP-сокетами и WEB-сервером
Написать приложение «Локальный чат» на архитектуре «клиент-сервер»,
Сообщение должно заканчиваться символом точка «.».

#### Задача 2*. Байт-стаффинг

Семинар 3. Работа с TCP-сокетами и WEB-сервером
Написать приложение «Локальный чат» на архитектуре «клиент-сервер» с использованием
байт-стаффинга (byte stuffing).

<table>
<tr><th>МНП</th><th>Сегмент данных</th><th>МКП</th></tr>
<tr><td>1 байт</td><td>Сообщения чата</td><td>1 байт</td></tr>
<tr><td>SOP = 0x7E</td><td></td><td>EOP = 0x7E</td></tr>
</table>

Где:

- МНП (SOP) – маркер начала пакета;
- МКП (EOP)– маркер конца пакета;

Сегмент данных не содержит кодов МНП и МКП (достигается применением вставки байт). Если в
передаваемых данных встречается код 0x7E, то он заменяется последовательностью 0x7D, 0x5E.
Если в передаваемых данных встречается код 0x7D, то он заменяется последовательностью 0x7D, 0x5D.
То есть:
0x7E = вставить 0x7D, заменить 0x7E на ( 0x7E xor 0x20) = 0x7D, 0x5E
0x7D = вставить 0x7D, заменить 0x7D на ( 0x7D xor 0x20) = 0x7D, 0x5D
При приеме данных происходит обратная замена
0x7D, 0x5E = отбросить 0x7D, заменить 0x5E на ( 0x5E xor 0x20) = 0x7E.
0x7D, 0x5D = отбросить 0x7D, заменить 0x5D на ( 0x5D xor 0x20) = 0x7D.

#### Задача 3. Кнопка

Используя практическое задание №2, необходимо «разобрать» кнопку, т.е. отправлять в консоль данные ее нажатия.

### Решение

Решение выполнялось с использованием корейского мини-компьютера [ODROID X2](https://www.hardkernel.com/shop/odroid-x2/), который выпускался 12 лет назад. 
10 лет назад снят с производства и поддержки - это главный минус, по сравнению с Raspberry Pi. 
Но, главным достоинством ялвяется, его цена и мощность. Данная "древняя" модель по мощности сравнима с современной малиной.
На ней установлена Ubuntu 16.04.

#### Задача 1. Локальный чат

Чат реализован с помощью двух частей:

1. [Серверная](https://github.com/allseenn/ciot/blob/main/03.Tasks/01/server.c)
2. [Клиентская](https://github.com/allseenn/ciot/blob/main/03.Tasks/01/client.c)

Серверная часть поддерживает много-поточность, позволяя одновременно подключаться нескольким клиентам.

Серверная часть запускается на мини-компьютере, а клиентская - на рабочих станциях.

<img src=01/01.png>

На скрине выше представлен терминал с 3-я вкладками. Средняя вкладка показывает вывод серверной части, запущенной на Odroid. Крайние показывают вывод клиентской части, запущенных на рабочих станциях: RedHat и Ubuntu.

Виден запуска сервера на порте 8080 и подключение клиентов.

<img src=01/02.png>

На втором скрине виден ввод и вывод клиента на RedHat. Для удобства идентификации вывод клиента с других рабочих станций сопровождается префиксом, с указанием адреса и порта удаленного клиента, с которым мы ведем переписку.

<img src=01/03.png>

На третьем скрине ввод и вывод клиента на Ubuntu. Который ведет переписку с RedHat.

Переписку можно вести и на русском языке.

Сервер поддерживает корректное завершения работы за счет макроса SIGINT из библиотеке signal.h. Что позволяет завершать его работу с помощь клавиш Ctrl+C или команды kill.

#### Задача 2*. Байт-стаффинг

В данном решение предыдущий код реализован с использованием байт-стаффинга.

#### Задача 2*. Байт-стаффинг

Вывод серверной части на Odroid:

<img src=02/01.png>

Вывод клиентской части на RedHat:

<img src=02/02.png>

Вывод клиентской части на Ubuntu:

<img src=02/03.png>

#### Задача 3. Кнопка

<img src=03/01.png>
<img src=03/02.png>
<img src=03/03.png>
<img src=03/04.png>
<img src=03/05.png>